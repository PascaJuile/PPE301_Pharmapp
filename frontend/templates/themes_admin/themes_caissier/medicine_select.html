{% extends "themes_admin/themes_pharmacien/medicine_list.html" %}
{% block content %}
{% load static %}

<style>
    /* Agrandir le titre principal */
    h1 {
        font-size: 2.8em;
        margin-top: 40px;
    }

    /* Agrandir les éléments de la table */
    .table {
        font-size: 2em;
    }

    .table th, .table td {
        padding: 30px;
    }

    /* Agrandir le texte des paragraphes */
    p {
        font-size: 1.8em;
    }

    /* Agrandir les champs de saisie */
    .form-control {
        font-size: 1.2em;
        padding: 12px;
    }

    /* Agrandir les boutons */
    .btn {
        font-size: 1.2em;
        padding: 10px 20px;
    }

    <style>
        #printableReceipt {
            display: block;
            text-align: center;
        }

        .receipt {
            display: inline-block;
            width: 80%;
            padding: 20px;
            margin: 0 auto;
            border: 1px solid #000;
            border-radius: 10px;
            font-family: Arial, sans-serif;
            position: relative;
            background-color: #fff;
        }

        .top-right-image {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 100px; /* Réduit la taille de l'image */
            height: auto;
        }

        .receipt h2 {
            margin: 20px 0;
        }

        .receipt p {
            margin: 10px 0;
        }

        .receipt table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .receipt table, .receipt th, .receipt td {
            border: 1px solid black;
        }

        .receipt th, .receipt td {
            padding: 12px;
            text-align: left;
        }

        .receipt th {
            background-color: #f2f2f2;
        }
</style>
</head>
<body>
    <div class="container">
        <h1 class="mt-5">Médicaments Sélectionnés Non Validés</h1>
        {% for selection in non_validated_medicines %}
        <h2>Selection ID: {{ selection.id }}</h2>
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Prix Unitaire</th>
                    <th>Quantité</th>
                </tr>
            </thead>
            <tbody>
                {% for medicament in selection.donnees %}
                <tr>
                    <td>{{ medicament.nom }}</td>
                    <td>{{ medicament.prix }}</td>
                    <td>{{ medicament.quantite }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button class="btn btn-primary" onclick="validerCommande('{{ selection.id }}')">Valider la commande</button>
        <div id="details-{{ selection.id }}" style="display: none; margin-top: 20px;">
            <p>Total: <span id="totalPrice-{{ selection.id }}">0.00</span></p>
            <div class="form-group">
                <label for="amountReceived-{{ selection.id }}">Montant Reçu:</label>
                <input type="number" class="form-control" id="amountReceived-{{ selection.id }}" placeholder="Entrez le montant reçu" oninput="calculateChange('{{ selection.id }}')">
            </div>
            <p>Reliquat: <span id="changeDue-{{ selection.id }}">0.00</span></p>
            <form method="post" action="{% url 'afficher_medicaments_selectionnes' %}">
                {% csrf_token %}
                <input type="hidden" name="selection_id" value="{{ selection.id }}">
                <input type="hidden" name="total_price" id="hiddenTotalPrice-{{ selection.id }}" value="">
                <button class="btn btn-success" type="submit">Down</button>
            </form>
        </div>
        {% endfor %}
    </div>

    <div id="printableReceipt" style="display:none;">
        <div class="receipt">
            <h2>Pharmacie XYZ</h2>
            <p>Adresse: Rue Exemple, Ville</p>
            <p>Date: {{ date }}</p>
            <table>
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Prix Unitaire</th>
                        <th>Quantité</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- This will be filled dynamically -->
                </tbody>
            </table>
            <p>Total: <span id="printTotalPrice">0.00</span></p>
            <p>Montant Reçu: <span id="printAmountReceived">0.00</span></p>
            <p>Reliquat: <span id="printChangeDue">0.00</span></p>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script>
    function calculateTotalPrice() {
        var totalPrice = 0;
        var rows = document.querySelectorAll("#medicinesTableBody tr");
        rows.forEach(function(row) {
            var price = parseFloat(row.cells[1].innerText);
            var quantity = parseInt(row.cells[2].innerText);
            totalPrice += price * quantity;
        });
        document.getElementById('totalPrice').innerText = totalPrice.toFixed(2);
        document.getElementById('printTotalPrice').innerText = totalPrice.toFixed(2);
    }

    <script>
        function validerCommande(selectionId) {
            var totalPrice = 0;
            var rows = document.querySelectorAll(`#details-${selectionId} tbody tr`);
            rows.forEach(function(row) {
                var price = parseFloat(row.cells[1].innerText);
                var quantity = parseInt(row.cells[2].innerText);
                totalPrice += price * quantity;
            });
            document.getElementById('totalPrice-' + selectionId).innerText = totalPrice.toFixed(2);
            document.getElementById('details-' + selectionId).style.display = 'block';
        }

        function calculateChange(selectionId) {
            var amountReceived = parseFloat(document.getElementById('amountReceived-' + selectionId).value);
            var totalPrice = parseFloat(document.getElementById('totalPrice-' + selectionId).innerText);
            var changeDue = amountReceived - totalPrice;

            document.getElementById('changeDue-' + selectionId).innerText = changeDue.toFixed(2);
        }

        function printReceipt(selectionId) {
            var amountReceived = parseFloat(document.getElementById('amountReceived-' + selectionId).value);
            var changeDue = parseFloat(document.getElementById('changeDue-' + selectionId).innerText);

            document.getElementById('printTotalPrice').innerText = totalPrice.toFixed(2);
            document.getElementById('printAmountReceived').innerText = amountReceived.toFixed(2);
            document.getElementById('printChangeDue').innerText = changeDue.toFixed(2);

        document.body.innerHTML = printContents;
        window.print();
        document.body.innerHTML = originalContents;
        window.location.reload(); // Reload to restore the original state
    }
</script>
</body>
{% endblock %}
